# Исправление ошибки 500 - База данных

## Проблема
Мобильное приложение выдает ошибку 500 при попытке загрузить оборудование.

## Возможные причины
1. База данных пустая (нет таблиц или нет данных)
2. Проблемы с подключением к базе данных
3. Таблицы не созданы

## Решение

### Шаг 1: Проверка и исправление базы данных

Запустите скрипт для автоматической диагностики:

```cmd
check-and-fix-db.bat
```

Этот скрипт:
- Проверит подключение к базе данных
- Проверит наличие таблиц
- Создаст таблицы если их нет
- Добавит тестовые данные (5 единиц оборудования) если таблица пустая

### Шаг 2: Применение исправлений на сервере

Если вы еще не применили исправления SSL:

```cmd
deploy-fix.bat
```

Этот скрипт скопирует:
- `backend/database.py` (исправление SSL)
- `backend/main.py` (улучшенная обработка ошибок)
- `backend/models.py` (восстановленные модели)
- `docker-compose.yml` (настройки окружения)

### Шаг 3: Проверка логов

После применения исправлений проверьте логи:

```bash
ssh root@5.129.203.182 "cd /opt/es-td-ngo && docker-compose logs backend --tail=50"
```

Должны увидеть:
- `✅ Database connection successful`
- `✅ Using SSL without certificate verification`
- При запросе `/api/equipment` - успешный ответ с данными

### Шаг 4: Ручная проверка базы данных

Если автоматический скрипт не помог, можно запустить диагностику вручную:

```bash
ssh root@5.129.203.182 "cd /opt/es-td-ngo && docker-compose exec backend python /app/check_db.py"
```

### Шаг 5: Проверка API напрямую

Проверьте работу API:

```bash
curl http://5.129.203.182:8000/api/equipment
```

Должен вернуться JSON с массивом `items` (может быть пустым, но не ошибка 500).

## Что было исправлено

1. **`backend/models.py`** - Восстановлен файл моделей базы данных
2. **`backend/check_db.py`** - Создан скрипт для диагностики и добавления тестовых данных
3. **`backend/database.py`** - Исправлена обработка SSL для самоподписанных сертификатов
4. **`deploy-fix.bat`** - Обновлен для копирования models.py

## Тестовые данные

Скрипт `check_db.py` автоматически создаст:
- 1 тип оборудования: "Сосуд под давлением"
- 5 единиц оборудования: Сосуд В-101, В-102, В-103, В-104, В-105

## Если проблема осталась

1. Проверьте логи backend на сервере
2. Убедитесь, что исправления применены (`deploy-fix.bat`)
3. Убедитесь, что база данных содержит данные (`check-and-fix-db.bat`)
4. Проверьте, что backend перезапущен после изменений



